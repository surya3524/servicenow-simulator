<!-- Modern Exception Handler UI -->
<div class="exception-handler-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1 class="title">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        {{ title }}
      </h1>
      <p class="subtitle">Process and analyze exception messages with AI-powered insights</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-wrapper">
      
      <!-- Exception Input Form -->
      <section class="card input-section">
        <h2 class="section-title">Exception Message</h2>
        <form [formGroup]="exceptionForm" (ngSubmit)="onSubmitException()">
          <div class="form-group">
            <label for="exceptionMessage" class="label">Enter your exception message or stack trace</label>
            <textarea
              id="exceptionMessage"
              formControlName="exceptionMessage"
              class="textarea"
              rows="8"
              placeholder="Paste your exception message here...&#10;&#10;Example:&#10;java.lang.NullPointerException: Cannot invoke 'String.length()' because 'str' is null&#10;    at com.example.MyClass.myMethod(MyClass.java:42)&#10;    at com.example.Main.main(Main.java:10)"
            ></textarea>
            <div class="error-message" *ngIf="exceptionForm.get('exceptionMessage')?.invalid && exceptionForm.get('exceptionMessage')?.touched">
              {{ getErrorMessage('exceptionMessage') }}
            </div>
          </div>
          
          <div class="button-group">
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="exceptionForm.invalid || isLoading"
            >
              <span *ngIf="!isLoading">
                <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
                Process Exception
              </span>
              <span *ngIf="isLoading" class="spinner">
                <svg class="spinner-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
                </svg>
                Processing...
              </span>
            </button>
            <button 
              type="button" 
              class="btn btn-secondary"
              (click)="resetForms()"
              *ngIf="apiResponse"
            >
              Clear All
            </button>
          </div>
        </form>
      </section>

      <!-- API Response Section -->
      <section class="card response-section" *ngIf="apiResponse">
        <div class="section-header">
          <h2 class="section-title">API Response</h2>
          <span class="status-badge" [ngClass]="apiResponse.success ? 'success' : 'error'">
            {{ apiResponse.success ? 'Success' : 'Error' }}
          </span>
        </div>
        
        <!-- JSON Formatted Output -->
        <div class="json-container">
          <div class="json-header">
            <span class="json-label">JSON Output</span>
            <button 
              type="button" 
              class="btn-copy"
              (click)="copyToClipboard(apiResponse)"
              title="Copy JSON"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
              </svg>
              Copy
            </button>
          </div>
          <pre class="json-output"><code>{{ formatJson(apiResponse) }}</code></pre>
        </div>

        <!-- Email Section -->
        <div class="email-section" *ngIf="showEmailForm">
          <h3 class="email-title">
            <svg class="icon-small" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
            </svg>
            Send via Email
          </h3>
          
          <form [formGroup]="emailForm" (ngSubmit)="onSendEmail()">
            <div class="form-row">
              <div class="form-group">
                <label for="to" class="label">Recipient Email</label>
                <input
                  type="email"
                  id="to"
                  formControlName="to"
                  class="input"
                  placeholder="recipient@example.com"
                />
                <div class="error-message" *ngIf="emailForm.get('to')?.invalid && emailForm.get('to')?.touched">
                  Please enter a valid email address
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="subject" class="label">Subject</label>
                <input
                  type="text"
                  id="subject"
                  formControlName="subject"
                  class="input"
                  placeholder="Exception Report"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="body" class="label">Email Body</label>
              <textarea
                id="body"
                formControlName="body"
                class="textarea"
                rows="6"
                placeholder="Email body..."
              ></textarea>
            </div>

            <button 
              type="submit" 
              class="btn btn-success"
              [disabled]="emailForm.invalid || isLoading"
            >
              <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
              {{ isLoading ? 'Sending...' : 'Send Email' }}
            </button>
          </form>
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p>&copy; 2025 Exception Handler. Built with Angular.</p>
  </footer>
</div>
